!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){"use strict";function o(t,e){var n=e.x-t.x,o=e.y-t.y;return 0===n?o>=0?180:0:n>0?180-(Math.atan(o/n)*(180/Math.PI)-90):-(Math.atan(o/n)*(180/Math.PI)-90)}function i(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function r(t){if(void 0===window.reach_resource_prefix)return t;var e=t.toLowerCase();return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("#")?t:window.reach_resource_prefix.concat(t)}n.d(e,"a",(function(){return o})),n.d(e,"c",(function(){return i})),n.d(e,"b",(function(){return r}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}));var o=n(0);function i(t,e,n){if(!0===t.options.floor)return function(t,e,n){var o=document.createElement("a-entity"),i=0;void 0!==t.options.direction&&(i=t.options.direction%12*-30),o.setAttribute("rotation",`0 ${i} 0`);var r=document.createElement("a-entity"),a=-2;void 0!==t.options.distance&&(a=t.options.distance),r.setAttribute("position",`0 0 ${a}`),r.setAttribute("rotation","-90 0 0");var s=document.createElement("a-entity");s.setAttribute("class","clickable"),s.setAttribute("id","background"),s.setAttribute("vr-passage-link",`name: ${t.link}; event: click`);var c="#0000ff",u="0.7",d="circle";void 0!==t.options.backgroundColor&&(c=t.options.backgroundColor),void 0!==t.options.backgroundOpacity&&(u=t.options.backgroundOpacity),void 0!==t.options.shape&&(d=t.options.shape),s.setAttribute("geometry",`primitive: ${d};`),s.setAttribute("material",`color:  ${c};  shader:  flat; opacity: ${u};`);var l=document.createElement("a-entity"),p="#FAFAFA";return void 0!==t.options.color&&(p=t.options.color),l.setAttribute("text",`align: center; color: ${p}; wrapCount: 18; width: 0.65; value: ${t.text};`),l.setAttribute("position","0 0 0.05"),o.appendChild(r),r.appendChild(s),r.appendChild(l),o}(t);var i=document.createElement("a-entity");i.setAttribute("position","0 1.6 0");var r=document.createElement("a-entity"),a=(e+1)%12*-30,s=0;void 0!==t.twinePosition&&(a=Object(o.a)(n,t.twinePosition)),void 0!==t.options.direction&&(a=t.options.direction%12*-30),void 0!==t.options.elevation&&(s=t.options.elevation%12*30),r.setAttribute("rotation",`${s} ${a} 0`);var c=document.createElement("a-entity"),u=-2;void 0!==t.options.distance&&(u=t.options.distance),c.setAttribute("position",`0 0 ${u}`);var d=document.createElement("a-entity");d.setAttribute("class","clickable"),d.setAttribute("id","background"),d.setAttribute("vr-passage-link",`name: ${t.link}; event: click`);var l="#0000ff",p="0.7",g="plane";void 0!==t.options.backgroundColor&&(l=t.options.backgroundColor),void 0!==t.options.backgroundOpacity&&(p=t.options.backgroundOpacity),void 0!==t.options.shape&&(g=t.options.shape),d.setAttribute("geometry",`primitive: ${g};`),d.setAttribute("material",`color:  ${l};  shader:  flat; opacity: ${p};`);var v=document.createElement("a-entity"),_="#FAFAFA";return void 0!==t.options.color&&(_=t.options.color),v.setAttribute("text",`align: center; color: ${_}; wrapCount: 18; width: 0.65; value: ${t.text};`),v.setAttribute("position","0 0 0.05"),i.appendChild(r),r.appendChild(c),c.appendChild(d),c.appendChild(v),i}function r(t,e,n){var i=document.createElement("a-entity");i.setAttribute("position","0 1.6 0");var r=document.createElement("a-entity"),a=2*(e+1)%12*30,s=0;void 0!==t.twinePosition&&(a=Object(o.a)(n,t.twinePosition)),void 0!==t.options.direction&&(a=t.options.direction%12*-30),void 0!==t.options.elevation&&(s=t.options.elevation%12*30),r.setAttribute("rotation",`${s} ${a} 0`);var c=document.createElement("a-entity"),u=-2;t.options.distance&&(u=t.options.distance),c.setAttribute("position",`0 0 ${u}`);var d=document.createElement("a-entity"),l="#ffffff",p="0.7",g="plane";void 0!==t.options.backgroundColor&&(l=t.options.backgroundColor),void 0!==t.options.backgroundOpacity&&(p=t.options.backgroundOpacity),void 0!==t.options.shape&&(g=t.options.shape),d.setAttribute("id","background"),d.setAttribute("geometry",`primitive: ${g}; width:1.5; height:${1.5/8.5*11}`),void 0!==t.backgrounds&&void 0!==t.backgrounds[0]?d.setAttribute("material",`shader:  flat; opacity: ${p}; src: ${t.backgrounds[0].src}; transparent: true;`):d.setAttribute("material",`color:  ${l};  shader:  flat; opacity: ${p};`);var v=document.createElement("a-entity"),_="#000000";return void 0!==t.options.color&&(_=t.options.color),v.setAttribute("text",`align: center; color: ${_}; wrapCount: 18; width: 0.65; value: ${t.text};`),v.setAttribute("position","0 0 0.05"),i.appendChild(r),r.appendChild(c),c.appendChild(d),c.appendChild(v),i}},function(t,e,n){"use strict";var o=n(0);function i(t,e){if(!0===t.options.video)return function(t,e){var n=`video-${e}`,i=document.querySelector(`#${n}`);if(null===i){var r=document.querySelector("a-assets");(i=document.createElement("video")).setAttribute("src",Object(o.b)(t.src)),i.setAttribute("autoplay","true"),i.setAttribute("loop","true"),i.setAttribute("id",n),r.appendChild(i)}var a=document.createElement("a-videosphere");return a.setAttribute("src",`#${n}`),i.play(),a}(t,e);var n=document.createElement("a-sky");void 0===t.src?n.setAttribute("src","#reach-default-360"):n.setAttribute("src",Object(o.b)(t.src));var i="true",r=5e3;return!1===t.options.transparent&&(i="false"),void 0!==t.options.distance&&(r=t.options.distance),n.setAttribute("transparent",i),n.setAttribute("radius",r),n}n.d(e,"a",(function(){return i}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var o=n(0);function i(t){var e=document.createElement("a-entity");e.setAttribute("position","0 1.6 0");var n=document.createElement("a-entity"),i=0,r=0;void 0!==t.options.direction&&(i=t.options.direction%12*-30),void 0!==t.options.elevation&&(r=t.options.elevation%12*30),n.setAttribute("rotation",`${r} ${i} 0`);var a=0;void 0!==t.options.direction&&(a=-2),void 0!==t.options.distance&&(a=t.options.distance),console.log("sound distance "+a);var s=document.createElement("a-sound");return s.setAttribute("src",Object(o.b)(t.src)),s.setAttribute("position",`0 0 ${a}`),s.setAttribute("autoplay","true"),s.setAttribute("loop","true"),n.appendChild(s),e.appendChild(n),e}},function(t,e,n){"use strict";n.r(e);n(5)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _utility_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_sky_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_sound_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3),_link_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1),storyDocument,startnode,currentPassageName,currentPassageTwinePosition;function loadPassage(t){currentPassageName=t.getAttribute("name"),currentPassageTwinePosition=getPassageTwinePosition(t);var e=document.querySelectorAll("video");if(null!==e)for(var n=0;n<e.length;n++)e[n].pause();var o=document.querySelector("#container");Object(_utility_js__WEBPACK_IMPORTED_MODULE_0__.c)(o),currentPassageTwinePosition=getPassageTwinePosition(t),document.querySelector("a-scene").setAttribute("background","color: black");var i=getBackgroundsInPassage(t);for(n=0;n<i.length;n++){var r=Object(_sky_js__WEBPACK_IMPORTED_MODULE_1__.a)(i[n],currentPassageName);null!==r&&o.appendChild(r)}var a=getLinksInPassage(t);for(n=0;n<a.length;n++){var s=a[n],c=Object(_link_js__WEBPACK_IMPORTED_MODULE_3__.a)(s,n,currentPassageTwinePosition);o.appendChild(c)}var u=getPanelsInPassage(t);for(n=0;n<u.length;n++){var d=u[n],l=Object(_link_js__WEBPACK_IMPORTED_MODULE_3__.b)(d,n,currentPassageTwinePosition);o.appendChild(l)}var p=getSoundsInPassage(t);for(n=0;n<p.length;n++){var g=p[n],v=Object(_sound_js__WEBPACK_IMPORTED_MODULE_2__.a)(g);o.appendChild(v)}if(0===i.length){var _=Object(_sky_js__WEBPACK_IMPORTED_MODULE_1__.a)({options:{transparent:!1}},currentPassageName);o.appendChild(_)}}function getPassageById(t){return storyDocument.querySelector(`tw-passagedata[pid='${t}']`)}function getPassageByName(t){var e=storyDocument.querySelector(`tw-passagedata[name='${t.replace("'","\\'")}']`);return null===e&&console.log(`Could not find passage with name: ${t}`),e}function getPassageTwinePosition(t){if(void 0===t)return console.log(`could not find position of passage with name: ${name}`),{x:0,y:0};var e=t.getAttribute("position");if(void 0===e)return{x:0,y:0};var n=e.split(",");return console.log(n),{x:n[0],y:n[1]}}function getLinksInPassage(t){for(var e,n=/(^|({\s*(.+)\s*})|[^`])\[\[\s*((.+)\s*\|\s*(.+)\s*|(.+)\s*)\]\]/g,o=t.textContent,i=[];null!==(e=n.exec(o));){var r={};if(e[2]&&(r=JSON.parse(e[1])),e[5]){var a=getPassageByName(e[6]);i.push({text:e[5],link:e[6],options:r,twinePosition:getPassageTwinePosition(a)})}else{a=getPassageByName(e[7]);i.push({text:e[7],link:e[7],options:r,twinePosition:getPassageTwinePosition(a)})}}return i}function getBackgroundsInPassage(t){for(var e,n=/({\s*(.+)\s*})?\(\(\s*(.+)\s*\)\)/g,o=t.textContent,i=[];null!==(e=n.exec(o));){var r={};e[1]&&(r=JSON.parse(e[1])),i.push({src:e[3],options:r})}return i}function getSoundsInPassage(t){for(var e,n=/({\s*(.+)\s*})?~~\s*(.+)\s*~~/g,o=t.textContent,i=[];null!==(e=n.exec(o));){var r={};e[1]&&(r=JSON.parse(e[1])),i.push({src:e[3],options:r})}return i}function getTextInPassage(t){return{text:t.textContent.replace(/({\s*.+\s*})?`?(\[\[\s*.+\s*\]\]|`([^`]+)`|~~\s*.+\s*~~|\(\(\s*.+\s*\)\))\s*\n?/g,""),options:{direction:0}}}function getPanelsInPassage(t){for(var e,n=/({\s*(.+)\s*})?`\[\[\s*((.+)\s*\|\s*(.+)\s*|(.+)\s*)\]\]/g,o=t.textContent,i=[];null!==(e=n.exec(o));){var r={};if(e[1]&&(r=JSON.parse(e[1])),e[4]){var a=getBackgroundsInPassage(s=getPassageByName(e[5]));i.push({text:getTextInPassage(s).text,options:r,backgrounds:a,twinePosition:getPassageTwinePosition(s)})}else{var s;a=getBackgroundsInPassage(s=getPassageByName(e[6]));i.push({text:getTextInPassage(s).text,options:r,backgrounds:a,twinePosition:getPassageTwinePosition(s)})}}return i}console.log("REACH-0.0.18,18"),AFRAME.registerComponent("vr-passage-link",{schema:{event:{type:"string",default:""},name:{type:"string",default:""}},init:function(){var t=this;this.eventHandlerFn=function(){loadPassage(getPassageByName(t.data.name))}},update:function(t){var e=this.data,n=this.el;t.event&&e.event!==t.event&&n.removeEventListener(t.event,this.eventHandlerFn),e.event&&n.addEventListener(e.event,this.eventHandlerFn)},remove:function(){var t=this.data,e=this.el;t.event&&e.removeEventListener(t.event,this.eventHandlerFn)}}),AFRAME.registerComponent("reach-load-local",{init:function(){storyDocument=document,console.log("here"),document.querySelector("a-scene").setAttribute("cursor","rayOrigin: mouse"),startnode=storyDocument.querySelector("tw-storydata").getAttribute("startnode");for(var userScripts=storyDocument.querySelector("tw-storydata").querySelectorAll('*[type="text/twine-javascript"]'),i=0;i<userScripts.length;i++){var script=userScripts[i].innerHTML;try{eval(script)}catch(t){console.log(t)}}if(null!==window.reach_preload_images)for(var i in window.reach_preload_images){var idTag=i,src=Object(_utility_js__WEBPACK_IMPORTED_MODULE_0__.b)(window.reach_preload_images[i]),img=document.createElement("img");img.setAttribute("id",idTag),img.setAttribute("src",src),document.querySelector("a-assets").appendChild(img)}var passage=getPassageById(startnode);loadPassage(passage)}}),document.querySelector("a-scene").setAttribute("reach-load-local",!0)}]);