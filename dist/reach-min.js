!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){"use strict";function i(t,e){var n=e.x-t.x,i=e.y-t.y;return 0===n?i>=0?180:0:n>0?180-(Math.atan(i/n)*(180/Math.PI)-90):-(Math.atan(i/n)*(180/Math.PI)-90)}function o(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function r(t){if(void 0===window.reach_resource_prefix)return t;var e=t.toLowerCase();return e.startsWith("http://")||e.startsWith("https://")||e.startsWith("#")?t:window.reach_resource_prefix.concat(t)}function a(t,e){return 2*t*Math.sin(e/2)}function s(t,e,n){var i=d(n.direction)-d(e.direction),o=l(n.inclination)-l(e.inclination);return{width:a(t,i),height:a(t,o)}}function c(t,e){return(t+e)/2}function u(t){var e=t.split(" ");return{corner1:{direction:parseFloat(e[0]),inclination:parseFloat(e[1])},corner2:{direction:parseFloat(e[2]),inclination:parseFloat(e[3])}}}function d(t){return t%12/-12*2*Math.PI}function l(t){return t%12/12*2*Math.PI}n.d(e,"b",(function(){return i})),n.d(e,"f",(function(){return o})),n.d(e,"c",(function(){return r})),n.d(e,"d",(function(){return s})),n.d(e,"a",(function(){return c})),n.d(e,"e",(function(){return u}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return r}));var i=n(0);function o(t,e,n){if(!0===t.options.floor)return function(t,e,n){var i=document.createElement("a-entity"),o=0;void 0!==t.options.direction&&(o=t.options.direction%12*-30),i.setAttribute("rotation",`0 ${o} 0`);var r=document.createElement("a-entity"),a=-2;void 0!==t.options.distance&&(a=-1*t.options.distance),r.setAttribute("position",`0 0 ${a}`),r.setAttribute("rotation","-90 0 0");var s=document.createElement("a-entity");s.setAttribute("class","clickable"),s.setAttribute("id","background"),s.setAttribute("vr-passage-link",`name: ${t.link}; event: click`);var c="#0000ff",u="0.7",d="circle";void 0!==t.options.backgroundColor&&(c=t.options.backgroundColor),void 0!==t.options.backgroundOpacity&&(u=t.options.backgroundOpacity),void 0!==t.options.shape&&(d=t.options.shape),s.setAttribute("geometry",`primitive: ${d};`),s.setAttribute("material",`color:  ${c};  shader:  flat; opacity: ${u};`);var l=document.createElement("a-entity"),p="#FAFAFA";return void 0!==t.options.color&&(p=t.options.color),l.setAttribute("text",`align: center; color: ${p}; wrapCount: 18; width: 0.65; value: ${t.text};`),l.setAttribute("position","0 0 0.05"),i.appendChild(r),r.appendChild(s),r.appendChild(l),i}(t);var o=document.createElement("a-entity");o.setAttribute("position","0 1.6 0");var r=document.createElement("a-entity"),a=(e+1)%12*-30,s=0,c=-2,u="1.0",d="1.0";if(void 0!==t.twinePosition&&(a=Object(i.b)(n,t.twinePosition)),void 0!==t.options.direction&&(a=t.options.direction%12*-30),void 0!==t.options.inclination&&(s=t.options.inclination%12*30),void 0!==t.options.distance&&(c=-1*t.options.distance),void 0!==t.options.width&&(u=t.options.width),void 0!==t.options.height&&(d=t.options.height),void 0!==t.options.corners){var l=Object(i.e)(t.options.corners),p=Object(i.d)(-1*c,l.corner1,l.corner2);a=Object(i.a)(l.corner1.direction,l.corner2.direction)%12*-30,s=Object(i.a)(l.corner1.inclination,l.corner2.inclination)%12*30,u=p.width,d=p.height}r.setAttribute("rotation",`${s} ${a} 0`);var g=document.createElement("a-entity");g.setAttribute("position",`0 0 ${c}`);var v=document.createElement("a-entity");v.setAttribute("class","clickable"),v.setAttribute("id","background"),v.setAttribute("vr-passage-link",`name: ${t.link}; event: click`);var _="#0000ff",b="0.7",h="plane";void 0!==t.options.backgroundColor&&(_=t.options.backgroundColor),void 0!==t.options.backgroundOpacity&&(b=t.options.backgroundOpacity),void 0!==t.options.shape&&(h=t.options.shape),v.setAttribute("geometry",`primitive: ${h}; width: ${u}; height: ${d};`),v.setAttribute("material",`color:  ${_};  shader:  flat; opacity: ${b};`);var m="#FAFAFA";return void 0!==t.options.color&&(m=t.options.color),v.setAttribute("text",`align: center; color: ${m}; wrapCount: 18; width: 0.65; value: ${t.text};`),o.appendChild(r),r.appendChild(g),g.appendChild(v),o}function r(t,e,n){var o=document.createElement("a-entity");o.setAttribute("position","0 1.6 0");var r=document.createElement("a-entity"),a=2*(e+1)%12*30,s=0,c=-2,u="1.5",d=`${u/8.5*11}`;if(void 0!==t.twinePosition&&(a=Object(i.b)(n,t.twinePosition)),void 0!==t.options.direction&&(a=t.options.direction%12*-30),void 0!==t.options.inclination&&(s=t.options.inclination%12*30),t.options.distance&&(c=-1*t.options.distance),void 0!==t.options.width&&(u=t.options.width),void 0!==t.options.height&&(d=t.options.height),void 0!==t.options.corners){var l=Object(i.e)(t.options.corners),p=Object(i.d)(-1*c,l.corner1,l.corner2);a=Object(i.a)(l.corner1.direction,l.corner2.direction)%12*-30,s=Object(i.a)(l.corner1.inclination,l.corner2.inclination)%12*30,u=p.width,d=p.height}r.setAttribute("rotation",`${s} ${a} 0`);var g=document.createElement("a-entity");g.setAttribute("position",`0 0 ${c}`);var v=document.createElement("a-entity"),_="#ffffff",b="0.7",h="plane";void 0!==t.options.backgroundColor&&(_=t.options.backgroundColor),void 0!==t.options.backgroundOpacity&&(b=t.options.backgroundOpacity),void 0!==t.options.shape&&(h=t.options.shape),v.setAttribute("id","background"),v.setAttribute("geometry",`primitive: ${h}; width:${u}; height:${d}`),void 0!==t.backgrounds&&void 0!==t.backgrounds[0]?v.setAttribute("material",`shader:  flat; opacity: ${b}; src: ${t.backgrounds[0].src}; transparent: true;`):v.setAttribute("material",`color:  ${_};  shader:  flat; opacity: ${b};`);var m="#000000";return void 0!==t.options.color&&(m=t.options.color),v.setAttribute("text",`align: center; color: ${m}; width: 0.85; wrapCount: 18; value: ${t.text};`),o.appendChild(r),r.appendChild(g),g.appendChild(v),o}},function(t,e,n){"use strict";var i=n(0);function o(t,e){if(!0===t.options.video)return function(t,e){var n=`video-${e}`,o=document.querySelector(`#${n}`);if(null===o){var r=document.querySelector("a-assets");(o=document.createElement("video")).setAttribute("src",Object(i.c)(t.src)),o.setAttribute("autoplay","true"),o.setAttribute("loop","true"),o.setAttribute("id",n),r.appendChild(o)}var a=document.createElement("a-videosphere");return a.setAttribute("src",`#${n}`),o.play(),a}(t,e);var n=document.createElement("a-sky");void 0===t.src?n.setAttribute("src","#reach-default-360"):n.setAttribute("src",Object(i.c)(t.src));var o="true",r=5e3;return!1===t.options.transparent&&(o="false"),void 0!==t.options.distance&&(r=t.options.distance),n.setAttribute("transparent",o),n.setAttribute("radius",r),n}n.d(e,"a",(function(){return o}))},function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var i=n(0);function o(t){var e=document.createElement("a-entity");e.setAttribute("position","0 1.6 0");var n=document.createElement("a-entity"),o=0,r=0;void 0!==t.options.direction&&(o=t.options.direction%12*-30),void 0!==t.options.inclination&&(r=t.options.inclination%12*30),n.setAttribute("rotation",`${r} ${o} 0`);var a=0;void 0!==t.options.direction&&(a=-2),void 0!==t.options.distance&&(a=-1*t.options.distance),console.log("sound distance "+a);var s=document.createElement("a-sound");return s.setAttribute("src",Object(i.c)(t.src)),s.setAttribute("position",`0 0 ${a}`),s.setAttribute("autoplay","true"),s.setAttribute("loop","true"),n.appendChild(s),e.appendChild(n),e}},function(t,e,n){"use strict";n.r(e);n(5)},function(module,__webpack_exports__,__webpack_require__){"use strict";var _utility_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),_sky_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(2),_sound_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(3),_link_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1),storyDocument,startnode,currentPassageName,currentPassageTwinePosition;function loadPassage(t){currentPassageName=t.getAttribute("name"),currentPassageTwinePosition=getPassageTwinePosition(t);var e=document.querySelectorAll("video");if(null!==e)for(var n=0;n<e.length;n++)e[n].pause();var i=document.querySelector("#container");Object(_utility_js__WEBPACK_IMPORTED_MODULE_0__.f)(i),currentPassageTwinePosition=getPassageTwinePosition(t),document.querySelector("a-scene").setAttribute("background","color: black");var o=getBackgroundsInPassage(t);for(n=0;n<o.length;n++){var r=Object(_sky_js__WEBPACK_IMPORTED_MODULE_1__.a)(o[n],currentPassageName);null!==r&&i.appendChild(r)}var a=getLinksInPassage(t);for(n=0;n<a.length;n++){var s=a[n],c=Object(_link_js__WEBPACK_IMPORTED_MODULE_3__.a)(s,n,currentPassageTwinePosition);i.appendChild(c)}var u=getPanelsInPassage(t);for(n=0;n<u.length;n++){var d=u[n],l=Object(_link_js__WEBPACK_IMPORTED_MODULE_3__.b)(d,n,currentPassageTwinePosition);i.appendChild(l)}var p=getSoundsInPassage(t);for(n=0;n<p.length;n++){var g=p[n],v=Object(_sound_js__WEBPACK_IMPORTED_MODULE_2__.a)(g);i.appendChild(v)}if(0===o.length){var _=Object(_sky_js__WEBPACK_IMPORTED_MODULE_1__.a)({options:{transparent:!1}},currentPassageName);i.appendChild(_)}}function getPassageById(t){return storyDocument.querySelector(`tw-passagedata[pid='${t}']`)}function getPassageByName(t){var e=storyDocument.querySelector(`tw-passagedata[name='${t.replace("'","\\'")}']`);return null===e&&console.log(`Could not find passage with name: ${t}`),e}function getPassageTwinePosition(t){if(void 0===t)return console.log(`could not find position of passage with name: ${name}`),{x:0,y:0};var e=t.getAttribute("position");if(void 0===e)return{x:0,y:0};var n=e.split(",");return console.log(n),{x:n[0],y:n[1]}}function getLinksInPassage(t){for(var e,n=/(^|({\s*(.+)\s*})|[^`])\[\[\s*((.+)\s*\|\s*(.+)\s*|(.+)\s*)\]\]/g,i=t.textContent,o=[];null!==(e=n.exec(i));){var r={};if(e[2]&&(r=JSON.parse(e[1])),e[5]){var a=getPassageByName(e[6]);o.push({text:e[5],link:e[6],options:r,twinePosition:getPassageTwinePosition(a)})}else{a=getPassageByName(e[7]);o.push({text:e[7],link:e[7],options:r,twinePosition:getPassageTwinePosition(a)})}}return o}function getBackgroundsInPassage(t){for(var e,n=/({\s*(.+)\s*})?\(\(\s*(.+)\s*\)\)/g,i=t.textContent,o=[];null!==(e=n.exec(i));){var r={};e[1]&&(r=JSON.parse(e[1])),o.push({src:e[3],options:r})}return o}function getSoundsInPassage(t){for(var e,n=/({\s*(.+)\s*})?~~\s*(.+)\s*~~/g,i=t.textContent,o=[];null!==(e=n.exec(i));){var r={};e[1]&&(r=JSON.parse(e[1])),o.push({src:e[3],options:r})}return o}function getTextInPassage(t){return{text:t.textContent.replace(/({\s*.+\s*})?`?(\[\[\s*.+\s*\]\]|`([^`]+)`|~~\s*.+\s*~~|\(\(\s*.+\s*\)\))\s*\n?/g,""),options:{direction:0}}}function getPanelsInPassage(t){for(var e,n=/({\s*(.+)\s*})?`\[\[\s*((.+)\s*\|\s*(.+)\s*|(.+)\s*)\]\]/g,i=t.textContent,o=[];null!==(e=n.exec(i));){var r={};if(e[1]&&(r=JSON.parse(e[1])),e[4]){var a=getBackgroundsInPassage(s=getPassageByName(e[5]));o.push({text:getTextInPassage(s).text,options:r,backgrounds:a,twinePosition:getPassageTwinePosition(s)})}else{var s;a=getBackgroundsInPassage(s=getPassageByName(e[6]));o.push({text:getTextInPassage(s).text,options:r,backgrounds:a,twinePosition:getPassageTwinePosition(s)})}}return o}console.log("REACH-0.0.18,18"),AFRAME.registerComponent("vr-passage-link",{schema:{event:{type:"string",default:""},name:{type:"string",default:""}},init:function(){var t=this;this.eventHandlerFn=function(){loadPassage(getPassageByName(t.data.name))}},update:function(t){var e=this.data,n=this.el;t.event&&e.event!==t.event&&n.removeEventListener(t.event,this.eventHandlerFn),e.event&&n.addEventListener(e.event,this.eventHandlerFn)},remove:function(){var t=this.data,e=this.el;t.event&&e.removeEventListener(t.event,this.eventHandlerFn)}}),AFRAME.registerComponent("rotation-reader",{init:function(){this.hudtext=document.querySelector("#hudtext")},tick:function(){this.hudtext.setAttribute("text",`value: dir:${(this.el.object3D.rotation.y/(2*Math.PI)*-12%12).toFixed(2)} ele:${(this.el.object3D.rotation.x/(2*Math.PI)*12%12).toFixed(2)}`)}}),AFRAME.registerComponent("reach-load-local",{init:function(){storyDocument=document,console.log("here"),document.querySelector("a-scene").setAttribute("cursor","rayOrigin: mouse"),document.querySelector("a-scene").setAttribute("raycaster","objects: .clickable");var cursor=storyDocument.querySelector("a-entity[cursor]");cursor.setAttribute("raycaster","objects: .clickable"),cursor.setAttribute("animation__click","property: scale; startEvents: click; easing: easeInCubic; dur: 150; from: 0.1 0.1 0.1; to: 1 1 1"),cursor.setAttribute("animation__mouseenter","property: scale; startEvents: mouseenter; easing: easeInCubic; dur: 100; from: 1 1 1; to: 1.2 1.2 1.2"),cursor.setAttribute("animation__mouseleave","property: scale; startEvents: mouseleave; easing: easeInCubic; dur: 100; to: 1 1 1"),cursor.setAttribute("material","color: black; shader: flat"),cursor.setAttribute("position","0 0 -1"),cursor.setAttribute("geometry","primitive: ring; radiusInner: 0.01; radiusOuter: 0.02;"),startnode=storyDocument.querySelector("tw-storydata").getAttribute("startnode");for(var userScripts=storyDocument.querySelector("tw-storydata").querySelectorAll('*[type="text/twine-javascript"]'),i=0;i<userScripts.length;i++){var script=userScripts[i].innerHTML;try{eval(script)}catch(t){console.log(t)}}if(null!==window.reach_preload_images)for(var i in window.reach_preload_images){var idTag=i,src=Object(_utility_js__WEBPACK_IMPORTED_MODULE_0__.c)(window.reach_preload_images[i]),img=document.createElement("img");img.setAttribute("id",idTag),img.setAttribute("src",src),img.setAttribute("crossorigin","anonymous"),document.querySelector("a-assets").appendChild(img)}var passage=getPassageById(startnode);if(loadPassage(passage),!0===window.reach_show_position){var hudtext=document.createElement("a-entity");hudtext.setAttribute("position","0 0 -1"),hudtext.setAttribute("text","value: 0 0"),hudtext.setAttribute("id","hudtext"),hudtext.setAttribute("geometry","primitive: plane; width:auto; height:auto};"),hudtext.setAttribute("material","color:  #000000;  shader:  flat; opacity: 0.3;");var camera=storyDocument.querySelector("a-camera");camera.appendChild(hudtext),camera.setAttribute("rotation-reader","")}}}),document.querySelector("a-scene").setAttribute("reach-load-local",!0)}]);